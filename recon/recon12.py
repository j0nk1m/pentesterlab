#WIP - does not return recon_12. easier to use web browser

#OBJECTIVE
#For this challenge, your goal is to access a load-balanced application 
#hosted at the address balancer.hackycorp.com.

#LOAD BALANCING
#Serving requests for a single application can be done by multiple backends. 
#It can pay off to send the same request multiple times to check if multiple backends are involved.

from urllib.request import Request, urlopen
import concurrent.futures
from bs4 import BeautifulSoup


NUM_THREADS = 100
host = "balancer"
hosts = [host for i in range(NUM_THREADS+1)]
url = Request('https://www.hackycorp.com')

def subdom_check(hosts):
    url.add_header('Host', f'{hosts}.hackycorp.com')
    url.add_header('User-agent', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.3')
    url.add_header('Accept','text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7')
    #url.add_header('Accept-Encoding','gzip, deflate')
    url.add_header('Accept-Language','en-US,en;q=0.9')
    url.add_header('Cache-Control','max-age=0')
    url.add_header('Connection','keep-alive')
    url.add_header('If-Modified-Since','Mon, 21 Dec 2023 01:38:24 GMT')
    url.add_header('If-None-Match','W/"5f156610-6c"')
    url.add_header('Upgrade-Insecure-Requests','1')
    try:
        content = urlopen(url)
        length = content.getheader('Content-Length')
        stuff = content.read()
        #print(url.header_items())
        if b"recon_12" in stuff:
            print(stuff)
    
    except Exception as e:
        print('Error', e)
        
with concurrent.futures.ThreadPoolExecutor(max_workers=NUM_THREADS) as executor:
    executor.map(subdom_check, hosts)
